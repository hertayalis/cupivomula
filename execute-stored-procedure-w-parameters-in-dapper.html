<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="I'm using Dapper (thanks Sam, great project.) a micro ORM with a DAL and by some reason I'm not able to execute stored procedures with input parameters. In a example service I've the following code: When the execution of the stored procedure is triggered a SqlException is thrown stating that I need to provide the"><meta name=generator content="Hugo 0.98.0"><meta name=robots content="index,follow,noarchive"><title>Execute stored procedure w/parameters in Dapper &#183;</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/blackburn.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel=stylesheet type=text/css><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=./img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=./index.html>PulseBlog</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=./index.html><i class="fa fa-home fa-fw"></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=./post/index.html><i class="fa fa-list fa-fw"></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=./sitemap.xml><i class="fa fa-user fa-fw"></i>Sitemap</a></li><li class=pure-menu-item><a class=pure-menu-link href=./index.xml><i class="fa fa-phone fa-fw"></i>RSS</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small>&copy; 2022. All rights reserved.</small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div></div></div><div id=main><div class=header><h1>Execute stored procedure w/parameters in Dapper</h1><h2>I'm using Dapper (thanks Sam, great project.) a micro ORM with a DAL and by some reason I'm not able to execute stored procedures with input parameters. In a example service I've the following code: When the execution of the stored procedure is triggered a SqlException is thrown stating that I need to provide the</h2></div><div class=content><div class=post-meta><div><i class="fa fa-calendar fa-fw"></i>
<time>17 Jul 2024, 00:00</time></div></div><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>I'm using <a href=# rel="nofollow noreferrer">Dapper</a> (thanks <a href=# rel="nofollow noreferrer">Sam</a>, great project.) a micro ORM with a DAL and by some reason I'm not able to execute stored procedures with input parameters.</p><p>In a example service I've the following code:</p><pre class="lang-cs prettyprint-override"><code>public void GetSomething(int somethingId) { IRepository&lt;Something, SomethingEnum&gt; repository = UnitOfWork.GetRepository&lt;Something, SomethingEnum&gt;(); var param = new DynamicParameters(); param.Add("@somethingId", dbType: DbType.Int32, value:somethingId, direction: ParameterDirection.Input); var result = repository.Exec&lt;Something&gt;(SomethingEnum.spMyStoredProcedure, param); ... } </code></pre><p>When the execution of the stored procedure is triggered a SqlException is thrown stating that I need to provide the 'somethingId'</p><p>Procedure or function 'spMyStoredProcedure' expects parameter '@somethingId', which was not supplied.</p><p>My <a href=# rel="nofollow noreferrer">DAL</a> is similar based on this github project of Pencroff.</p><p>Am I missing something here?</p><p><strong>Update:</strong> I am actually passing the commandType via the SomethingEnum:</p><pre class="lang-cs prettyprint-override"><code>public class SomethingEnum : EnumBase&lt;SomethingEnum, string&gt; { public static readonly SomethingEnum spMyStoredProcedure = new SomethingEnum("spMyStoredProcedure", "[dbo].[spMyStoredProcedure]", CommandType.StoredProcedure); public SomethingEnum(string Name, string EnumValue, CommandType? cmdType): base(Name, EnumValue, cmdType) { } } </code></pre><span class=d-none itemprop=commentCount></span><h2 class=mb0 data-answercount=5>5 Answers</h2><p>You need to tell it the command type: make sure there's a <code>commandType: CommandType.StoredProcedure</code> in the dapper call. Otherwise, it is simply executing the <strong>text</strong> command:</p><pre><code>spMyStoredProcedure </code></pre><p>(with some unused parameters in the ambient context). This is legal TSQL, and attempts to call <code>spMyStoredProcedure</code> without passing parameters - the same as if you put <code>spMyStoredProcedure</code> into SSMS and press f5.</p><p>Also, if your parameters are fixed, I would actually suggest just using:</p><pre><code>var param = new { somethingId }; </code></pre><p>or even just inline it completely:</p><pre><code>var result = repository.Exec&lt;Something&gt;(SomethingEnum.spMyStoredProcedure, new { somethingId }, commandType: CommandType.StoredProcedure); </code></pre><p>(note: if your <code>Exec&lt;T></code> method only ever handles stored procedures, you could move the <code>commandType</code> internal to the method - or you could make it an optional parameter that defaults to <code>CommandType.StoredProcedure</code>)</p><span class=d-none itemprop=commentCount>6</span><pre><code>var queryParameters = new DynamicParameters(); queryParameters.Add("@parameter1", valueOfparameter1); queryParameters.Add("@parameter2", valueOfparameter2); await db.QueryAsync&lt;YourReturnType&gt;( "{NameOfStoredProcedure}", queryParameters, commandType: CommandType.StoredProcedure) </code></pre><span class=d-none itemprop=commentCount>1</span><p>Since this was the top result for me, but there were no answers that deal with ExecuteNonQuery with table valued parameters, here is the code for that:</p><pre><code>var queryParameters = new DynamicParameters(); queryParameters.Add("@Param0", datatable0.AsTableValuedParameter()); queryParameters.Add("@Param1", datatable1.AsTableValuedParameter()); var result = await ExecuteStoredProc("usp_InsertUpdateTest", queryParameters); private async Task&lt;Result&lt;int&gt;&gt; ExecuteStoredProc(string sqlStatement, DynamicParameters parameters) { try { using (SqlConnection conn = new SqlConnection(connectionString)) { await conn.OpenAsync(); var affectedRows = await conn.ExecuteAsync( sql: sqlStatement, param: parameters, commandType: CommandType.StoredProcedure); return Result.Ok(affectedRows); } } catch (Exception e) { //do logging return Result.Fail&lt;int&gt;(e.Message); } } </code></pre><span class=d-none itemprop=commentCount>2</span><p>You'll need to extend it to support outbound parameters and returning results, but it contains the portion for creating the Dapper dynamic parameters.</p><pre><code>internal static bool ExecuteProc(string sql, List&lt;SqlParameter&gt; paramList = null) { try { using (SqlConnection conn = new SqlConnection (GetConnectionString())) { DynamicParameters dp = new DynamicParameters(); if(paramList != null) foreach (SqlParameter sp in paramList) dp.Add(sp.ParameterName, sp.SqlValue, sp.DbType); conn.Open(); return conn.Execute(sql, dp, commandType: CommandType.StoredProcedure) &gt; 0; } } catch (Exception e) { //do logging return false; } </code></pre><p>}</p><span class=d-none itemprop=commentCount>2</span><p>This works for me. Note that the method doing this is async, hence the await and QueryAsync. Also notice that an anonymous type is created to facilitate the 'Id' parameter being sent.</p><pre><code>await dbConnection.QueryAsync&lt;Something&gt;("StoredProcedureNameGoesHere @Id", new { Id = id }); </code></pre><span class=d-none itemprop=commentCount></span><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJoaWptaW2BdIOOnq%2Bem6Wpsm6%2F06ipnpxdpb%2Bwr8SdrKudXax6sa3RmqSerJWnwG61zWabmqigmr8%3D</p><h4><i class="fas fa-share-alt" aria-hidden=true></i>&nbsp;Share!</h4><ul class=share-buttons><li><a href="https://www.facebook.com/sharer/sharer.php?u=%2fexecute-stored-procedure-w-parameters-in-dapper.html" target=_blank title="Share on Facebook"><i class="fab fa-facebook" aria-hidden=true></i><span class=sr-only>Share on Facebook</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://twitter.com/intent/tweet?source=%2fexecute-stored-procedure-w-parameters-in-dapper.html" target=_blank title=Tweet><i class="fab fa-twitter" aria-hidden=true></i><span class=sr-only>Tweet</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://plus.google.com/share?url=%2fexecute-stored-procedure-w-parameters-in-dapper.html" target=_blank title="Share on Google+"><i class="fab fa-google-plus" aria-hidden=true></i><span class=sr-only>Share on Google+</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.tumblr.com/share?v=3&u=%2fexecute-stored-procedure-w-parameters-in-dapper.html" target=_blank title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden=true></i><span class=sr-only>Post to Tumblr</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://pinterest.com/pin/create/button/?url=%2fexecute-stored-procedure-w-parameters-in-dapper.html" target=_blank title="Pin it"><i class="fab fa-pinterest-p" aria-hidden=true></i><span class=sr-only>Pin it</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.reddit.com/submit?url=%2fexecute-stored-procedure-w-parameters-in-dapper.html" target=_blank title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden=true></i><span class=sr-only>Submit to Reddit</span></a></li></ul><style>ul.share-buttons{list-style:none;padding:0}ul.share-buttons li{display:inline}ul.share-buttons .sr-only{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}</style><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=./max-religion-welcome-to-plathville.html><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=./max-religion-welcome-to-plathville.html>Max Comes From a Big Family on 'Welcome to Plathville'</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24><nav class=next><a href=./ashley-judd-networth.html>A Breakdown of the Actress' Income</a></nav></div><div class=pure-u-1-24 style=text-align:right><a href=./ashley-judd-networth.html><i class="fa fa-chevron-right"></i></a></div></div></div></div></div><script src=https://assets.cdnweb.info/hugo/blackburn/js/ui.js></script>
<script src=https://assets.cdnweb.info/hugo/blackburn/js/menus.js></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://iklan.listspress.com/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://iklan.listspress.com/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>